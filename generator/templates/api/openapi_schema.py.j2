"""
OpenAPI Schema Configuration for {{ project.name }}

Generated by Django Enhanced Generator on {{ now().strftime('%Y-%m-%d %H:%M:%S') }}.
"""
from drf_spectacular.views import (
    SpectacularAPIView,
    SpectacularRedocView,
    SpectacularSwaggerView,
)
from drf_spectacular.utils import extend_schema_view, extend_schema
from django.urls import path


class CustomSpectacularAPIView(SpectacularAPIView):
    """Custom OpenAPI schema view with additional configuration."""

    def get(self, request, *args, **kwargs):
        """Generate OpenAPI schema with custom settings."""
        schema = super().get(request, *args, **kwargs)

        # Add custom schema modifications
        schema.data['info']['x-logo'] = {
            'url': '{{ project.logo_url|default("/static/images/logo.png") }}',
            'altText': '{{ project.name }} Logo'
        }

        # Add custom tags
        if 'tags' not in schema.data:
            schema.data['tags'] = []

        {% for app in apps %}
        schema.data['tags'].append({
            'name': '{{ app.name }}',
            'description': '{{ app.description|default(app.name + " API endpoints") }}',
        })
        {% endfor %}

        return schema


# URL patterns for API documentation
urlpatterns = [
    # OpenAPI schema
    path('schema/', CustomSpectacularAPIView.as_view(), name='schema'),

    # Swagger UI
    path(
        'swagger/',
        SpectacularSwaggerView.as_view(url_name='schema'),
        name='swagger-ui'
    ),

    # ReDoc
    path(
        'redoc/',
        SpectacularRedocView.as_view(url_name='schema'),
        name='redoc'
    ),
]


# DRF Spectacular settings for this project
SPECTACULAR_SETTINGS = {
    'TITLE': '{{ project.name }} API',
    'DESCRIPTION': '{{ project.description|default("API documentation for " + project.name) }}',
    'VERSION': '{{ project.version|default("1.0.0") }}',
    'SERVE_INCLUDE_SCHEMA': False,

    # Authentication
    'SECURITY': [
        {% if features.authentication.jwt %}
        {'bearerAuth': []},
        {% endif %}
        {% if features.authentication.token %}
        {'tokenAuth': []},
        {% endif %}
        {% if features.authentication.session %}
        {'sessionAuth': []},
        {% endif %}
    ],

    # Schema customization
    'TAGS': [
        {% for app in apps %}
        {
            'name': '{{ app.name }}',
            'description': '{{ app.description|default(app.name + " related endpoints") }}'
        },
        {% endfor %}
    ],

    # Components
    'COMPONENT_SPLIT_REQUEST': True,
    'COMPONENT_SPLIT_RESPONSE': True,

    # Preprocessing hooks
    'PREPROCESSING_HOOKS': [
        'drf_spectacular.hooks.preprocess_exclude_path_format',
    ],

    # Postprocessing hooks
    'POSTPROCESSING_HOOKS': [
        'drf_spectacular.hooks.postprocess_schema_enums',
    ],

    # Schema generation
    'SCHEMA_PATH_PREFIX': '/api/v[0-9]',
    'SCHEMA_MOUNT_PATH': '/api/schema/',

    # UI customization
    'SWAGGER_UI_SETTINGS': {
        'deepLinking': True,
        'persistAuthorization': True,
        'displayOperationId': True,
        'defaultModelsExpandDepth': 2,
        'defaultModelExpandDepth': 2,
        'defaultModelRendering': 'model',
        'displayRequestDuration': True,
        'docExpansion': 'none',
        'filter': True,
        'showExtensions': True,
        'showCommonExtensions': True,
        'supportedSubmitMethods': [
            'get',
            'put',
            'post',
            'delete',
            'options',
            'head',
            'patch',
            'trace',
        ],
    },

    'REDOC_UI_SETTINGS': {
        'disableSearch': False,
        'hideDownloadButton': False,
        'hideHostname': False,
        'expandResponses': '200,201',
        'jsonSampleExpandLevel': 2,
        'lazyRendering': True,
        'menuToggle': True,
        'nativeScrollbars': False,
        'noAutoAuth': False,
        'pathInMiddlePanel': False,
        'requiredPropsFirst': True,
        'scrollYOffset': 0,
        'showExtensions': True,
        'sortPropsAlphabetically': False,
        'suppressWarnings': False,
        'theme': {
            'colors': {
                'primary': {
                    'main': '#007bff',
                },
            },
            'typography': {
                'fontSize': '14px',
                'fontFamily': '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
            },
        },
    },
}