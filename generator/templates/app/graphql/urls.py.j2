"""
GraphQL URL configuration for {{ project.name }} project.

Generated by Django Enhanced Generator on {{ now().strftime('%Y-%m-%d %H:%M:%S') }}.
"""
from django.urls import path
from django.views.decorators.csrf import csrf_exempt
from graphene_django.views import GraphQLView
{% if features.authentication.jwt %}
from graphql_jwt.decorators import jwt_cookie
{% endif %}

from {{ project.name }}.schema import schema


app_name = 'graphql'

urlpatterns = [
    path(
        'graphql/',
        {% if features.authentication.jwt %}
        jwt_cookie(
            {% endif %}
            csrf_exempt(
                GraphQLView.as_view(
                    schema=schema,
                    graphiql={% if project.debug %}True{% else %}False{% endif %},
                )
            )
            {% if features.authentication.jwt %}
        )
        {% endif %},
        name='graphql',
    ),
    {% if project.debug %}
    path(
        'graphiql/',
        GraphQLView.as_view(
            schema=schema,
            graphiql=True,
        ),
        name='graphiql',
    ),
    {% endif %}
]

{% if features.api.graphql_ws %}
# WebSocket routing for subscriptions
from channels.routing import ProtocolTypeRouter, URLRouter
from django.urls import re_path
from graphene_subscriptions.consumers import GraphqlWsConsumer

websocket_urlpatterns = [
    re_path(r'ws/graphql/$', GraphqlWsConsumer.as_asgi()),
]

application = ProtocolTypeRouter({
    'websocket': URLRouter(websocket_urlpatterns),
})
{% endif %}