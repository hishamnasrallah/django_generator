"""
URL configuration for {{ app_name }} API.

Generated by Django Enhanced Generator on {{ now().strftime('%Y-%m-%d %H:%M:%S') }}.
"""
from django.urls import path, include
from rest_framework.routers import DefaultRouter
{% if has_nested_routes %}from rest_framework_nested import routers as nested_routers
{% endif %}

from . import views

app_name = '{{ app_name }}'

# Create router
router = DefaultRouter()

{% for model in models %}
{% if model.api and model.api.viewset != false %}
# Register {{ model.name }} viewset
router.register(
    r'{{ url_config.routes|selectattr('viewset', 'equalto', model.name + 'ViewSet')|first|attr('url')|default(model.name|lower + 's') }}',
    views.{{ model.name }}ViewSet,
    basename='{{ url_config.routes|selectattr('viewset', 'equalto', model.name + 'ViewSet')|first|attr('basename')|default(model.name|lower) }}'
)
{% endif %}
{% endfor %}

{% if has_nested_routes %}
# Nested routes
{% for nested in url_config.nested_routes %}
{{ nested.parent|lower }}_router = nested_routers.NestedDefaultRouter(
    router,
    r'{{ nested.parent|lower }}s',
    lookup='{{ nested.parent_lookup }}'
)
{{ nested.parent|lower }}_router.register(
    r'{{ nested.url }}',
    views.{{ nested.child }}ViewSet,
    basename='{{ nested.parent|lower }}-{{ nested.child|lower }}'
)
{% endfor %}
{% endif %}

# URL patterns
urlpatterns = [
    # Router URLs
    path('', include(router.urls)),

    {% if has_nested_routes %}
    # Nested router URLs
    {% for nested in url_config.nested_routes %}
    path('', include({{ nested.parent|lower }}_router.urls)),
    {% endfor %}
    {% endif %}

    {% if has_api_views %}
    # Custom API views
    {% for pattern in url_config.custom_patterns %}
    path('{{ pattern.url }}/', views.{{ pattern.view }}.as_view(), name='{{ pattern.name }}'),
    {% endfor %}
    {% endif %}

    {% if has_custom_actions %}
    # Additional endpoints
    {% for model in models %}
    {% if model.api and model.api.custom_endpoints %}
    {% for endpoint in model.api.custom_endpoints %}
    path(
        '{{ endpoint.path }}',
        views.{{ endpoint.view|default(model.name + endpoint.name|title_case + 'View') }}.as_view(),
        name='{{ endpoint.name }}'
    ),
    {% endfor %}
    {% endif %}
    {% endfor %}
    {% endif %}
]

# Add format suffixes
from rest_framework.urlpatterns import format_suffix_patterns
urlpatterns = format_suffix_patterns(urlpatterns)