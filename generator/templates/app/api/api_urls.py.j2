"""
API URL configuration for {{ app_name }} app.

Generated by Django Enhanced Generator on {{ now().strftime('%Y-%m-%d %H:%M:%S') }}.
"""
from django.urls import path, include
from rest_framework.routers import DefaultRouter
{% if has_nested_routes %}
from rest_framework_nested import routers as nested_routers
{% endif %}

from .views import {% for model in models %}{% if model.api and model.api.viewset != false %}{{ model.name }}ViewSet{% if not loop.last %}, {% endif %}{% endif %}{% endfor %}
{% if has_api_views %}
from .views import {% for pattern in url_config.custom_patterns %}{{ pattern.view }}{% if not loop.last %}, {% endif %}{% endfor %}
{% endif %}

# Create router
router = DefaultRouter()

{% for model in models %}
{% if model.api and model.api.viewset != false %}
# Register {{ model.name }} viewset
router.register(
    r'{{ model.name|lower }}s',
    {{ model.name }}ViewSet,
    basename='{{ model.name|lower }}'
)
{% endif %}
{% endfor %}

{% if has_nested_routes %}
# Nested routes
{% for nested in url_config.nested_routes %}
{{ nested.parent|lower }}_router = nested_routers.NestedDefaultRouter(
    router,
    r'{{ nested.parent|lower }}s',
    lookup='{{ nested.parent_lookup }}'
)
{{ nested.parent|lower }}_router.register(
    r'{{ nested.url }}',
    {{ nested.child }}ViewSet,
    basename='{{ nested.parent|lower }}-{{ nested.child|lower }}'
)
{% endfor %}
{% endif %}

# API URL patterns
api_urlpatterns = [
    # Include router URLs
    path('', include(router.urls)),

    {% if has_nested_routes %}
    # Include nested router URLs
    {% for nested in url_config.nested_routes %}
    path('', include({{ nested.parent|lower }}_router.urls)),
    {% endfor %}
    {% endif %}

    {% if has_api_views %}
    # Custom API views
    {% for pattern in url_config.custom_patterns %}
    path('{{ pattern.url }}/', {{ pattern.view }}.as_view(), name='{{ pattern.name }}'),
{% endfor %}
{% endif %}

{% if has_custom_actions %}
# Additional API endpoints
{% for model in models %}
{% if model.api and model.api.custom_endpoints %}
# {{ model.name }} custom endpoints
{% for endpoint in model.api.custom_endpoints %}
path(
    '{{ model.name|lower }}/{{ endpoint.path }}',
{{ endpoint.view|default(model.name + endpoint.name|title + 'APIView') }}.as_view(),
name='{{ model.name|lower }}-{{ endpoint.name }}'
),
{% endfor %}
{% endif %}
{% endfor %}
{% endif %}
]

# Main URL configuration
urlpatterns = [
    # API v1 URLs
    path('api/v1/', include(api_urlpatterns)),

    # API documentation (if enabled)
    {% if features.api.documentation %}
    path('api/', include('{{ project.name }}.api_docs_urls')),
    {% endif %}
]