"""
Main GraphQL schema for {{ project.name }} project.

Generated by Django Enhanced Generator on {{ now().strftime('%Y-%m-%d %H:%M:%S') }}.
"""
import graphene
from graphene_django.debug import DjangoDebug
{% if features and features.get('authentication', {}).get('jwt') %}
import graphql_jwt
{% endif %}

{% for app in apps %}
{% if app and app.get('models') %}
from apps.{{ app.name }}.graphql.schema import schema as {{ app.name }}_schema
{% endif %}
{% endfor %}


class Query(
    {% for app in apps %}
    {% if app and app.get('models') %}
    {{ app.name }}_schema.Query,
    {% endif %}
    {% endfor %}
    graphene.ObjectType
):
    """Root query combining all app queries."""

    {% if project and project.get('debug') %}
    debug = graphene.Field(DjangoDebug, name='_debug')
    {% endif %}

    node = graphene.relay.Node.Field()


class Mutation(
    {% for app in apps %}
    {% if app and app.get('models') %}
    {{ app.name }}_schema.Mutation,
    {% endif %}
    {% endfor %}
    graphene.ObjectType,
):
    """Root mutation combining all app mutations."""

    {% if features and features.get('authentication', {}).get('jwt') %}
    # JWT Authentication mutations
    token_auth = graphql_jwt.ObtainJSONWebToken.Field()
    verify_token = graphql_jwt.Verify.Field()
    refresh_token = graphql_jwt.Refresh.Field()
    revoke_token = graphql_jwt.Revoke.Field()
{% endif %}


{% set has_subscriptions = namespace(value=false) %}
{% for app in apps if app %}
{% if app.get('graphql', {}).get('subscriptions', False) %}
{% set has_subscriptions.value = true %}
{% endif %}
{% endfor %}
{% if has_subscriptions.value %}
class Subscription(
    {% for app in apps if app %}
    {% if app.get('graphql', {}).get('subscriptions', False) %}
    {{ app.name }}_schema.Subscription,
    {% endif %}
    {% endfor %}
    graphene.ObjectType,
):
    """Root subscription combining all app subscriptions."""
    pass
{% endif %}


# Main schema
schema = graphene.Schema(
    query=Query,
    mutation=Mutation,
    {% if has_subscriptions.value %}
    subscription=Subscription,
    {% endif %}
)